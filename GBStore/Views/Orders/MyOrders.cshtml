@model IEnumerable<GBStore.Models.Order>
@using System.Globalization

@{
    ViewBag.Title = "Đơn hàng của tôi";
}

@functions {
    string GetOrderStatusText(string? status)
    {
        return status?.ToUpper() switch
        {
            "PENDING" => "Chờ xác nhận",
            "PROCESSING" => "Đang xử lý",
            "SHIPPED" => "Đang giao hàng",
            "COMPLETED" => "Hoàn tất",
            "CANCELLED" => "Đã hủy",
            _ => "Không xác định"
        };
    }
}

<div class="container py-5">
    <h2 class="mb-4">Đơn hàng của tôi</h2>

    @if (!Model.Any())
    {
        <div class="alert alert-info">
            Bạn chưa có đơn hàng nào.
        </div>
    }

    @foreach (var order in Model)
    {
        var status = order.OrderStatus?.ToUpper();

        <div class="order-card mb-4">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <span class="order-id">
                        Đơn hàng #@order.OrderId
                    </span>
                    <span class="order-date">
                        @(order.OrderDate.HasValue
                                            ? order.OrderDate.Value.ToString("dd/MM/yyyy")
                                            : "")
                                             </span>
                                         </div>

                <div class="card-body">

                    <!-- Progress tracker -->
                    <div class="progress-tracker mb-4">
                        <div class="progress-step @(status != "PENDING" ? "completed" : "active")">
                            <i class="bi bi-cart-check"></i>
                            <span>Đặt hàng</span>
                        </div>

                        <div class="progress-step @(status == "PROCESSING" || status == "SHIPPED" || status == "COMPLETED" ? "completed" : "")">
                            <i class="bi bi-gear"></i>
                            <span>Xử lý</span>
                        </div>

                        <div class="progress-step @(status == "SHIPPED" || status == "COMPLETED" ? "completed" : "")">
                            <i class="bi bi-truck"></i>
                            <span>Giao hàng</span>
                        </div>

                        <div class="progress-step @(status == "COMPLETED" ? "completed" : "")">
                            <i class="bi bi-box-seam"></i>
                            <span>Hoàn tất</span>
                        </div>
                    </div>

                    <!-- Summary -->
                    <div class="row align-items-center border-top pt-3">
                        <div class="col-md-6">
                            <p class="mb-1">
                                Trạng thái:
                                <span class="badge
                                        @(status == "COMPLETED" ? "bg-success" :
                                                                            status == "SHIPPED" ? "bg-primary" :
                                                                            status == "PROCESSING" ? "bg-warning text-dark" :
                                                                                                    "bg-secondary")">
                                @GetOrderStatusText(order.OrderStatus)
                            </span>
                        </p>

                            <p class="mb-0">
                                Tổng tiền:
                                <strong>
                                    @order.TotalAmount.ToString("c0", new CultureInfo("vi-VN"))
                                </strong>
                            </p>
                        </div>

                        <div class="col-md-6 text-md-end mt-3 mt-md-0">
                            <a asp-controller="OrderDetails"
                               asp-action="Index"
                               asp-route-id="@order.OrderId"
                               class="btn btn-outline-primary btn-sm me-2">
                                <i class="bi bi-eye me-1"></i>
                                Xem chi tiết
                            </a>

                        @if (status == "COMPLETED")
                            {
                                <button class="btn btn-primary btn-sm">
                                    Mua lại
                                </button>
                            }
                        </div>
                    </div>

                </div>
            </div>
        </div>
    }
</div>
